<!DOCTYPE html>
<html lang="zh-TW">
	<head>
		<meta charset="UTF-8"/>
		<meta name='viewport' content="width=device-width, initial-scale=1.0"/>
		<title>檸檬子簽到表</title>
		<link href=" https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css " rel="stylesheet">
		<link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
		<link rel="stylesheet" href="/resources/demos/style.css">
		<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
		<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
		<script>
		$( function() {
		$( "#datepicker" ).datepicker({dateFormat: "yy/mm/dd"});
		} );

		</script>
	</head>
	<body>
		<div class="container" id="app">
			<form onsubmit="return submitform();">
			  <div class="mb-3">
				<h4><label for="selectdate" class="form-label">請選擇要簽到的【日期】</label></h4>
				<input type="text" class="form-control" id="datepicker" required="required">
			  </div>
			  
			  <div class="mb-3">
			    <h4><label for="selectclassidx" class="form-label">請選擇要簽到的【堂次】</label></h4>				
				<input type="radio" class="btn-check" name="classidx" id="option1" autocomplete="off" value="1" required="required">
				<label class="btn btn-outline-secondary" for="option1">1</label>

				<input type="radio" class="btn-check" name="classidx" id="option2" autocomplete="off" value="2">
				<label class="btn btn-outline-secondary" for="option2">2</label>

				<input type="radio" class="btn-check" name="classidx" id="option3" autocomplete="off" value="3">
				<label class="btn btn-outline-secondary" for="option3">3</label>

				<input type="radio" class="btn-check" name="classidx" id="option4" autocomplete="off" value="4">
				<label class="btn btn-outline-secondary" for="option4">4</label>
				
				<input type="radio" class="btn-check" name="classidx" id="option5" autocomplete="off" value="5">
				<label class="btn btn-outline-secondary" for="option5">5</label>

				<input type="radio" class="btn-check" name="classidx" id="option6" autocomplete="off" value="6">
				<label class="btn btn-outline-secondary" for="option6">6</label>

				<input type="radio" class="btn-check" name="classidx" id="option7" autocomplete="off" value="7">
				<label class="btn btn-outline-secondary" for="option7">7</label>

				<input type="radio" class="btn-check" name="classidx" id="option8" autocomplete="off" value="8">
				<label class="btn btn-outline-secondary" for="option8">8</label>
			  </div>
			  
			  <div class="mb-3" id="signlist">
			    <h4><label for="inputname" class="form-label">請填寫要簽到的學生【姓名】與選擇課別</label></h4>
			    <div class="mb-3" id="sn-1-div">
			    	<input type="text" class="form-control" name="sn-names" id="sn-1" required="required" onchange="addclasslist(this);">
			    </div>
			  </div>

			  <button type="submit" class="btn btn-primary">Submit</button>
		  	  <button type="button" class="btn btn-outline-primary" style="float: right" onclick="addsignlist()">新增姓名欄位</button>
			</form>
		</div>
		

		<script type="text/javascript">			
			function addclasslist(e){	
				var signdiv=document.getElementById(e.id+'-div');
				if (e.value ==''){
					signdiv.removeChild(document.getElementById(e.id+'-radio'));
				}
				else{
					if(document.getElementById(e.id+'-radio')==null){
						var new_radiodiv=document.createElement('div');
						new_radiodiv.setAttribute("class","btn-group");
						new_radiodiv.setAttribute("role","group");
						new_radiodiv.setAttribute("aria-label",e.id+"-type");
						new_radiodiv.setAttribute("id",e.id+"-radio");

						var classlist=["繪畫","創意","幼幼","書法","暑假","寒假"];			
						for (i=0;i<classlist.length;i++){
							var new_radioinput=document.createElement('input');
							new_radioinput.setAttribute("type","radio");
							new_radioinput.setAttribute("class","btn-check");
							new_radioinput.setAttribute("name",e.id+"-radio");
							new_radioinput.setAttribute("id",e.id+"-radio-"+i);
							new_radioinput.setAttribute("autocomplete","off");
							new_radioinput.setAttribute("value",classlist[i]);
							if (i==0){
								new_radioinput.setAttribute("required","required");
							}					
							new_radiodiv.appendChild(new_radioinput);
							
							var new_radiolabel=document.createElement('label');
							new_radiolabel.setAttribute("class","btn btn-outline-secondary");
							new_radiolabel.setAttribute("for",e.id+"-radio-"+i);
							var new_radiolabeltext = document.createTextNode(classlist[i]);
							new_radiolabel.appendChild(new_radiolabeltext);
							new_radiodiv.appendChild(new_radiolabel);
						}
						signdiv.appendChild(new_radiodiv);
					}
					else{
						signdiv.removeChild(document.getElementById(e.id+'-radio'));
						var new_radiodiv=document.createElement('div');
						new_radiodiv.setAttribute("class","btn-group");
						new_radiodiv.setAttribute("role","group");
						new_radiodiv.setAttribute("aria-label",e.id+"-type");
						new_radiodiv.setAttribute("id",e.id+"-radio");

						var classlist=["繪畫","創意","幼幼","書法","暑假","寒假"];			
						for (i=0;i<classlist.length;i++){
							var new_radioinput=document.createElement('input');
							new_radioinput.setAttribute("type","radio");
							new_radioinput.setAttribute("class","btn-check");
							new_radioinput.setAttribute("name",e.id+"-radio");
							new_radioinput.setAttribute("id",e.id+"-radio-"+i);
							new_radioinput.setAttribute("autocomplete","off");
							new_radioinput.setAttribute("value",classlist[i]);
							if (i==0){
								new_radioinput.setAttribute("required","required");
							}					
							new_radiodiv.appendChild(new_radioinput);
							
							var new_radiolabel=document.createElement('label');
							new_radiolabel.setAttribute("class","btn btn-outline-secondary");
							new_radiolabel.setAttribute("for",e.id+"-radio-"+i);
							var new_radiolabeltext = document.createTextNode(classlist[i]);
							new_radiolabel.appendChild(new_radiolabeltext);
							new_radiodiv.appendChild(new_radiolabel);
						}
						signdiv.appendChild(new_radiodiv);
					}
					

				}
						

			}
			
			function addsignlist (){

				var signlist = document.getElementById('signlist');

				var signlist_len = document.getElementsByName('sn-names').length+1;
				var new_sninput_id="sn-"+signlist_len;
				var new_sninput=document.createElement('input');
				new_sninput.setAttribute("type","text");
				new_sninput.setAttribute("class","form-control");
				new_sninput.setAttribute("name","sn-names");
				new_sninput.setAttribute("id",new_sninput_id);
				new_sninput.setAttribute("onchange","addclasslist(this);");

				var new_sndiv_id=new_sninput_id+"-div";	
				var new_sndiv=document.createElement('div');
				new_sndiv.setAttribute("class","mb-3");
				new_sndiv.setAttribute("id",new_sndiv_id);
				


				new_sndiv.appendChild(new_sninput);	    								   
				signlist.appendChild(new_sndiv);
			}


			function submitform (){
				var selectdate = document.getElementById("datepicker").value;
				var selectclass = document.querySelector( 'input[name=classidx]:checked').value;
				var signnamelist=[];
				var classtypelist=[];
				document.querySelectorAll('input[name="sn-names"]').forEach((elem) => {
					if (elem.value != ''){
						var snclass = document.querySelector( 'input[name='+elem.id+'-radio]:checked').value;
						signnamelist.push(elem.value);
						classtypelist.push(snclass);
					}
				    });
				//var signnamelist=signnamelist.toString();
				//var classtypelist=classtypelist.toString();
				var studentlist=[];
				for (i=0;i<signnamelist.length;i++){
					studentlist.push(signnamelist[i]+":"+classtypelist[i]);
				}
				var studentlist=studentlist.toString();
				var signresult = confirm("要簽到的日期:【"+selectdate+"】\n要簽到的堂次:【第"+selectclass+"堂】\n要簽到的學生:【"+studentlist+"】");
					if (signresult){
						var signnamelist=signnamelist.toString();
						var classtypelist=classtypelist.toString();
						liff
						  .init({
						    liffId: "1661169478-MwNYEGYm", // Use own liffId
						  })
						  .then(() => {
							liff
							  .sendMessages([{
								"type":"text",
								"text":'"簽到日期":"'+selectdate+'",\n"簽到堂次":"'+selectclass+'",\n"簽到姓名":"'+signnamelist+'",\n"簽到班別":"'+classtypelist+'"'
							  }])
							  .then(() => {
							     liff.closeWindow();
							  })
							  .catch((err) => {
							    alert("很抱歉，【簽到訊息並未成功發出】，請由line頻道中開始重新操作，或聯絡系統管理員!");
							    liff.closeWindow();
							  });
						  })
						  .catch((err) => {
						    alert("很抱歉，【line訊息聯結並未啟動】，請重新操作，或聯絡系統管理員!");
						    liff.closeWindow();
						  });
					}
				return false
			}
		</script>
		<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js "></script>
	</body>
</html>
